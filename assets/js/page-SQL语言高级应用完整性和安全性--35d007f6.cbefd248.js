(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{619:function(s,a,t){"use strict";t.r(a);var e=t(3),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"sql-语言高级应用-完整性和安全性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-语言高级应用-完整性和安全性"}},[s._v("#")]),s._v(" SQL 语言高级应用 : 完整性和安全性")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"完整性约束的-sql-定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#完整性约束的-sql-定义"}},[s._v("#")]),s._v(" 完整性约束的 SQL 定义")]),s._v(" "),t("blockquote",[t("p",[s._v("数据库系统必须保证数据库中的数据是完整的")]),s._v(" "),t("p",[s._v("在更新数据库系统时 关系中不能出现不满足约束的方法")]),s._v(" "),t("p",[s._v("但是这种检查往往低效 复杂 重复的 而且不可靠")])]),s._v(" "),t("h3",{attrs:{id:"完整性约束和主码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#完整性约束和主码"}},[s._v("#")]),s._v(" 完整性约束和主码")]),s._v(" "),t("p",[s._v("在 SQL 中 实体完整性通过主码"),t("code",[s._v("Primary Key")]),s._v(" 的定义来实现")]),s._v(" "),t("p",[s._v("一旦某个属性是主码 该属性就不能为空值 且不能出现两个相同的值")]),s._v(" "),t("p",[s._v("在 SQL 中可以使用以下两种定义的方法")]),s._v(" "),t("ul",[t("li",[s._v("是在属性后增加关键字")]),s._v(" "),t("li",[s._v("属性表中加入额外的定义主码的子句")])]),s._v(" "),t("p",[s._v("如果有多个主码 使用 "),t("code",[s._v("Primary KEY (Ino,Eno)")])]),s._v(" "),t("h3",{attrs:{id:"参照完整性约束和外部码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参照完整性约束和外部码"}},[s._v("#")]),s._v(" 参照完整性约束和外部码")]),s._v(" "),t("blockquote",[t("p",[s._v("利用外部码的说明实现参照完整性约束")])]),s._v(" "),t("h4",{attrs:{id:"外部码的约束的说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#外部码的约束的说明"}},[s._v("#")]),s._v(" 外部码的约束的说明")]),s._v(" "),t("ul",[t("li",[s._v("在该属性的说明后加上关键字\n"),t("ul",[t("li",[t("code",[s._v("References <父表名>(<属性名>)")])])])]),s._v(" "),t("li",[s._v("在创建表语句的后面添加语句\n"),t("ul",[t("li",[t("code",[s._v("Foreign Key(<属性表名>) references <父表名>(<属性名表>)")])])])])]),s._v(" "),t("h4",{attrs:{id:"参照完整性约束的实现策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参照完整性约束的实现策略"}},[s._v("#")]),s._v(" 参照完整性约束的实现策略")]),s._v(" "),t("p",[s._v("规定外部码的取值只有两种情况")]),s._v(" "),t("ul",[t("li",[s._v("取空值")]),s._v(" "),t("li",[s._v("取被参照关系中的主码值")])]),s._v(" "),t("p",[s._v("SQL 中提供了三种可选方案")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("RESTRICT")]),s._v(" 限制策略\n"),t("ul",[t("li",[s._v("是 SQL 默认")])])]),s._v(" "),t("li",[t("code",[s._v("CASCADE")]),s._v(" 级联策略\n"),t("ul",[t("li",[s._v("当删除或修改父表中某元组的主码值时")]),s._v(" "),t("li",[s._v("子表中具有该外部码值的元组也将被删除或修改以保证参照完整性")])])]),s._v(" "),t("li",[t("code",[s._v("SET NULL")]),s._v(" 置空策略\n"),t("ul",[t("li",[s._v("针对父表的删除或修改操作的")])])])]),s._v(" "),t("h3",{attrs:{id:"用户自定义完整性约束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户自定义完整性约束"}},[s._v("#")]),s._v(" 用户自定义完整性约束")]),s._v(" "),t("h4",{attrs:{id:"基于属性的check约束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于属性的check约束"}},[s._v("#")]),s._v(" 基于属性的"),t("code",[s._v("CHECK")]),s._v("约束")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("check")]),s._v("子句的一般格式为")]),s._v(" "),t("p",[t("code",[s._v("CHECK (<condition>)")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("Age "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHECK")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" Age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"基于元组的check约束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于元组的check约束"}},[s._v("#")]),s._v(" 基于元组的"),t("code",[s._v("CHECK")]),s._v("约束")]),s._v(" "),t("p",[s._v("对表内属性的约束进行说明")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" Salary\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    Insure "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("decimal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    Fund "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("decimal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    Basepay "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("decimal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHECK")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Insure "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" Fund "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" Basepay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"约束的更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#约束的更新"}},[s._v("#")]),s._v(" 约束的更新")]),s._v(" "),t("p",[s._v("为了便于修改和删除约束 需要再定义约束的时候为约束进行命名")]),s._v(" "),t("p",[s._v("在约束前加上关键字 "),t("code",[s._v("CONSTRAINT")]),s._v("和该约束的名称")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONSTRAINT")]),s._v(" RightSalary "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHECK")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Insure "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" Fund "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" Basepay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这样 可以使用 "),t("code",[s._v("alter table")]),s._v(" 语句来更新与属性或表有关的约束")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" Employee "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("constraint")]),s._v(" FK_employee\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("由于 SQL 不能直接修改约束 可通过以下两步完成对约束的修改")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("删除原约束")]),s._v(" "),t("ul",[t("li",[t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" Salary\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("constraint")]),s._v(" RightSalary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[s._v("增加同名约束 即起到覆盖的效果")]),s._v(" "),t("ul",[t("li",[t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" Salary\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("constraint")]),s._v(" RightSalary "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("insure "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" fund "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" rest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"sql-中的触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-中的触发器"}},[s._v("#")]),s._v(" SQL 中的触发器")]),s._v(" "),t("p",[s._v("一旦被定义 任何用户触发该触发器之后 系统都会自动激活相应激发动作")]),s._v(" "),t("h3",{attrs:{id:"触发器的组成和类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#触发器的组成和类型"}},[s._v("#")]),s._v(" 触发器的组成和类型")]),s._v(" "),t("p",[s._v("触发器定义包括两个方面")]),s._v(" "),t("ul",[t("li",[s._v("指明触发器的出发事件")]),s._v(" "),t("li",[s._v("指明触发器执行的动作")])]),s._v(" "),t("p",[s._v("触发事件包括 "),t("strong",[s._v("插入 删除 修改")])]),s._v(" "),t("p",[s._v("事件的触发还包括两个相关时间 "),t("strong",[s._v("BEFORE 和 AFTER")])]),s._v(" "),t("p",[s._v("触发动作实际上是一系列 SQL 语句 可以有两种方式")]),s._v(" "),t("ul",[t("li",[s._v("对被事件影响的每一行 执行一次触发过程 "),t("code",[s._v("For each row")]),s._v(" "),t("ul",[t("li",[s._v("称为 "),t("strong",[s._v("行级触发器")])])])]),s._v(" "),t("li",[s._v("对整个事件只执行一次触发过程 "),t("code",[s._v("For each statement")]),s._v(" "),t("ul",[t("li",[s._v("称为 "),t("strong",[s._v("语句级触发器")])])])])]),s._v(" "),t("h3",{attrs:{id:"创建触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建触发器"}},[s._v("#")]),s._v(" 创建触发器")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("语句基本格式")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("trigger")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("trigger_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("{ before "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("after")]),s._v(" }"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n {"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("column_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" }\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" table_name\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("referencin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("临时视图名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("触发条件"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("触发动作"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" each { "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" statement }"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("说明")]),s._v(" "),t("p",[s._v("TBD")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);